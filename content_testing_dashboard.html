<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TALYX - Content Testing Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./prototype/css/styles_sidebar.css">
    <style>
        /* Testing Dashboard Specific Styles */
        .testing-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .testing-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .control-group label {
            font-weight: 600;
            min-width: 80px;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .load-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .load-btn:hover {
            transform: translateY(-1px);
        }

        .testing-status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            border-left: 4px solid #28a745;
        }

        .error-status {
            border-left-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .debug-panel {
            background: #263238;
            color: #a7c0cd;
            padding: 15px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .available-stories {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .story-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .story-card {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .story-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .story-card.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .content-display {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        /* Enhanced styles for dynamic content */
        .story-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .story-meta {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .series-badge,
        .level-badge,
        .time-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .series-badge {
            background: #e3f2fd;
            color: #1976d2;
        }

        .level-badge {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .time-badge {
            background: #e8f5e8;
            color: #388e3c;
        }

        .learning-objectives {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .story-section {
            margin-bottom: 30px;
            padding: 20px;
            border-left: 4px solid #667eea;
            background: rgba(102, 126, 234, 0.02);
        }

        .section-title {
            color: #667eea;
            margin-bottom: 20px;
        }

        .bilingual-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .bilingual-content {
                grid-template-columns: 1fr;
            }
        }

        .language-label {
            font-weight: 600;
            margin-bottom: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            display: inline-block;
        }

        .audio-btn,
        .vocab-audio-btn {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .audio-btn:hover,
        .vocab-audio-btn:hover {
            background: rgba(0,0,0,0.1);
        }

        .section-vocabulary,
        .vocabulary-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .vocab-grid,
        .vocab-expansion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .vocab-card,
        .expandable-vocab-card {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e1e5e9;
        }

        .vocab-french {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .vocab-english {
            color: #666;
            font-size: 14px;
        }

        .expandable-vocab-card .vocab-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vocab-expansion {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
            display: none;
        }

        .expandable-vocab-card.expanded .vocab-expansion {
            display: block;
        }

        .progress-tracker {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .progress-sections {
            display: grid;
            gap: 10px;
            margin: 15px 0;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .progress-item.completed {
            background: #e8f5e8;
        }

        .progress-number {
            background: #667eea;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .progress-status {
            margin-left: auto;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="testing-header">
        <h1>üß™ TALYX Content Testing Dashboard</h1>
        <p>Test MD content loading and rendering with full feature integration</p>
    </div>

    <div class="container">
        <!-- Testing Controls -->
        <div class="testing-controls">
            <h3>‚öôÔ∏è Content Loading Controls</h3>
            
            <div class="control-group">
                <label>CEFR Level:</label>
                <select id="level-select">
                    <option value="A1">A1 - Beginner</option>
                    <option value="A2">A2 - Elementary</option>
                    <option value="B1">B1 - Intermediate</option>
                    <option value="B2">B2 - Upper Intermediate</option>
                    <option value="C1">C1 - Advanced</option>
                </select>
            </div>

            <div class="control-group">
                <label>Story File:</label>
                <input type="text" id="filename-input" placeholder="detective_marie_03_mysterious_letter" 
                       value="detective_marie_03_mysterious_letter">
            </div>

            <div class="control-group">
                <button class="load-btn" onclick="loadAndRenderStory()">
                    üöÄ Load & Render Story
                </button>
                <button class="load-btn" onclick="scanAvailableStories()" style="background: #28a745;">
                    üìÅ Scan Available Stories
                </button>
                <button class="load-btn" onclick="clearContent()" style="background: #dc3545;">
                    üóëÔ∏è Clear Content
                </button>
            </div>
        </div>

        <!-- Status Display -->
        <div id="status-display" class="testing-status">
            Ready to load content. Select a CEFR level and story filename, then click "Load & Render Story".
        </div>

        <!-- Debug Panel -->
        <div id="debug-panel" class="debug-panel">
            <strong>Debug Console:</strong><br>
            System initialized. Waiting for content loading operations...
        </div>

        <!-- Available Stories -->
        <div class="available-stories">
            <h3>üìö Available Stories</h3>
            <div id="story-list" class="story-list">
                <div class="story-card" onclick="loadQuickStory('A1', 'detective_marie_03_mysterious_letter')">
                    <h4>Detective Marie Chapter 3</h4>
                    <p>Level: A1-A2 | The Mysterious Letter</p>
                    <small>Future tense, directions, family vocabulary</small>
                </div>
                <div class="story-card" onclick="loadQuickStory('A2', 'detective_marie_04_garden_mystery')">
                    <h4>Detective Marie Chapter 4</h4>
                    <p>Level: A2-B1 | The Garden Mystery</p>
                    <small>Past perfect, character development</small>
                </div>
                <div class="story-card" onclick="loadQuickStory('A1', 'detective_marie_02_stolen_wallet')">
                    <h4>Detective Marie Chapter 2</h4>
                    <p>Level: A1-A2 | The Stolen Wallet</p>
                    <small>Past tense, descriptions, clothing vocabulary</small>
                </div>
            </div>
        </div>

        <!-- Content Display Area -->
        <div id="main-content" class="content-display">
            <div style="text-align: center; color: #666; padding: 50px;">
                <h3>üìñ Content will appear here</h3>
                <p>Load a story using the controls above to see the rendered content with all interactive features.</p>
            </div>
        </div>
    </div>

    <!-- Include the content loading and rendering modules -->
    <script src="./js/content_loader.js"></script>
    <script src="./js/content_renderer.js"></script>

    <script>
        // Initialize dashboard
        let contentLoader;
        let contentRenderer;
        let loadedStories = new Map();

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            contentLoader = new ContentLoader();
            contentRenderer = new ContentRenderer('main-content');
            
            updateDebug('Dashboard initialized successfully');
            updateStatus('Content loading system ready. Select a story to begin testing.');
        });

        // Load and render story function
        async function loadAndRenderStory() {
            const level = document.getElementById('level-select').value;
            const filename = document.getElementById('filename-input').value.trim();
            
            if (!filename) {
                updateStatus('Please enter a story filename', 'error');
                return;
            }

            updateStatus(`Loading ${level}/${filename}...`);
            updateDebug(`Attempting to load: ${level}/stories/${filename}.md`);

            try {
                const content = await contentLoader.loadStory(level, filename);
                updateDebug(`Content loaded successfully: ${content.sections.length} sections, ${content.metadata.title}`);
                
                contentRenderer.renderStory(content);
                updateStatus(`Successfully rendered: ${content.metadata.title} (${content.sections.length} sections)`);
                updateDebug(`Rendering complete. Interactive features initialized.`);
                
                // Store for quick access
                loadedStories.set(`${level}_${filename}`, content);
                
            } catch (error) {
                updateStatus(`Error loading content: ${error.message}`, 'error');
                updateDebug(`Loading failed: ${error.stack || error.message}`);
            }
        }

        // Quick story loading
        async function loadQuickStory(level, filename) {
            document.getElementById('level-select').value = level;
            document.getElementById('filename-input').value = filename;
            
            // Highlight selected card
            document.querySelectorAll('.story-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.story-card').classList.add('selected');
            
            await loadAndRenderStory();
        }

        // Scan for available stories
        async function scanAvailableStories() {
            updateStatus('Scanning content directory for available stories...');
            updateDebug('Beginning content directory scan...');

            const levels = ['A1', 'A2', 'B1', 'B2', 'C1'];
            const knownStories = [
                'detective_marie_02_stolen_wallet',
                'detective_marie_03_mysterious_letter', 
                'detective_marie_04_garden_mystery'
            ];

            let foundStories = [];

            for (const level of levels) {
                for (const story of knownStories) {
                    try {
                        const content = await contentLoader.loadStory(level, story);
                        foundStories.push({
                            level,
                            filename: story,
                            title: content.metadata.title,
                            series: content.metadata.series,
                            estimatedTime: content.metadata.estimated_time
                        });
                        updateDebug(`Found: ${level}/${story} - ${content.metadata.title}`);
                    } catch (error) {
                        // Story not found at this level, continue
                    }
                }
            }

            updateStatus(`Scan complete: Found ${foundStories.length} available stories`);
            updateDebug(`Scan results: ${foundStories.map(s => `${s.level}/${s.filename}`).join(', ')}`);
            
            // Update story list display
            updateStoryList(foundStories);
        }

        // Update story list display
        function updateStoryList(stories) {
            const storyList = document.getElementById('story-list');
            
            storyList.innerHTML = stories.map(story => `
                <div class="story-card" onclick="loadQuickStory('${story.level}', '${story.filename}')">
                    <h4>${story.title || story.filename}</h4>
                    <p>Level: ${story.level} | ${story.series || 'Story Series'}</p>
                    <small>${story.estimatedTime || '15 minutes'} | Interactive content ready</small>
                </div>
            `).join('');
        }

        // Clear content
        function clearContent() {
            contentRenderer.clearContent();
            updateStatus('Content cleared. Ready to load new story.');
            updateDebug('Content display cleared successfully');
        }

        // Update status display
        function updateStatus(message, type = 'success') {
            const statusEl = document.getElementById('status-display');
            statusEl.textContent = message;
            statusEl.className = `testing-status ${type === 'error' ? 'error-status' : ''}`;
        }

        // Update debug panel
        function updateDebug(message) {
            const debugEl = document.getElementById('debug-panel');
            const timestamp = new Date().toLocaleTimeString();
            debugEl.innerHTML += `<br>[${timestamp}] ${message}`;
            debugEl.scrollTop = debugEl.scrollHeight;
        }

        // Make functions globally available for testing
        window.testingDashboard = {
            loadStory: loadAndRenderStory,
            clearContent: clearContent,
            scanStories: scanAvailableStories,
            getLoader: () => contentLoader,
            getRenderer: () => contentRenderer,
            getLoadedStories: () => loadedStories
        };
    </script>
</body>
</html>
